(function(n){"use strict";function i(i,r){var u=this,f=i.attr("name")||r.name||"";this.options=r;this.$el=i.hide();this.$label=this.$el.closest("label")||this.$el.attr("id")&&n(t('label[for="%s"]',this.$el.attr("id").replace(/:/g,"\\:")));this.$parent=n(t('<div class="ms-parent %s" %s/>',i.attr("class")||"",t('title="%s"',i.attr("title"))));this.$choice=n(t('<button type="button" class="ms-choice"><span class="placeholder">%s<\/span><div><\/div><\/button>',this.options.placeholder));this.$drop=n(t('<div class="ms-drop %s"><\/div>',this.options.position));this.$el.after(this.$parent);this.$parent.append(this.$choice);this.$parent.append(this.$drop);this.$el.prop("disabled")&&this.$choice.addClass("disabled");this.$parent.css("width",this.options.width||this.$el.css("width")||this.$el.outerWidth()+20);this.selectAllName='data-name="selectAll'+f+'"';this.selectGroupName='data-name="selectGroup'+f+'"';this.selectItemName='data-name="selectItem'+f+'"';this.options.keepOpen||n(document).click(function(t){n(t.target)[0]!==u.$choice[0]&&n(t.target).parents(".ms-choice")[0]!==u.$choice[0]&&(n(t.target)[0]===u.$drop[0]||n(t.target).parents(".ms-drop")[0]!==u.$drop[0]&&t.target!==i[0])&&u.options.isOpen&&u.close()})}var t=function(n){var i=arguments,t=!0,r=1;return n=n.replace(/%s/g,function(){var n=i[r++];return typeof n=="undefined"?(t=!1,""):n}),t?n:""};i.prototype={constructor:i,init:function(){var r=this,i=n("<ul><\/ul>");this.$drop.html("");this.options.filter&&this.$drop.append('<div class="ms-search"><input type="text" autocomplete="off" autocorrect="off" autocapitilize="off" spellcheck="false"><\/div>');this.options.selectAll&&!this.options.single&&i.append(['<li class="ms-select-all">',"<label>",t('<input type="checkbox" %s /> ',this.selectAllName),this.options.selectAllDelimiter[0],this.options.selectAllText,this.options.selectAllDelimiter[1],"<\/label>","<\/li>"].join(""));n.each(this.$el.children(),function(n,t){i.append(r.optionToHtml(n,t))});i.append(t('<li class="ms-no-results">%s<\/li>',this.options.noMatchesFound));this.$drop.append(i);this.$drop.find("ul").css("max-height",this.options.maxHeight+"px");this.$drop.find(".multiple").css("width",this.options.multipleWidth+"px");this.$searchInput=this.$drop.find(".ms-search input");this.$selectAll=this.$drop.find("input["+this.selectAllName+"]");this.$selectGroups=this.$drop.find("input["+this.selectGroupName+"]");this.$selectItems=this.$drop.find("input["+this.selectItemName+"]:enabled");this.$disableItems=this.$drop.find("input["+this.selectItemName+"]:disabled");this.$noResults=this.$drop.find(".ms-no-results");this.events();this.updateSelectAll(!0);this.update(!0);this.options.isOpen&&this.open()},optionToHtml:function(i,r,u,f){var s=this,e=n(r),l=e.attr("class")||"",a=t('title="%s"',e.attr("title")),v=this.options.multiple?"multiple":"",o,y=this.options.single?"radio":"checkbox";if(e.is("option")){var c=e.val(),p=s.options.textTemplate(e),w=e.prop("selected"),b=t('style="%s"',this.options.styler(c));return o=f||e.prop("disabled"),n([t('<li class="%s %s" %s %s>',v,l,a,b),t('<label class="%s">',o?"disabled":""),t('<input type="%s" %s%s%s%s value="%s">',y,this.selectItemName,w?' checked="checked"':"",o?' disabled="disabled"':"",t(' data-group="%s"',u),c),p,"<\/label>","<\/li>"].join(""))}if(e.is("optgroup")){var u="group_"+i,k=s.options.labelTemplate(e),h=n("<div/>");return o=e.prop("disabled"),h.append(['<li class="group">',t('<label class="optgroup %s" data-group="%s">',o?"disabled":"",u),this.options.hideOptgroupCheckboxes?"":t('<input type="checkbox" %s %s>',this.selectGroupName,o?'disabled="disabled"':""),k,"<\/label>","<\/li>"].join("")),n.each(e.children(),function(n,t){h.append(s.optionToHtml(n,t,u,o))}),h.html()}},events:function(){var i=this,r=function(n){n.preventDefault();i[i.options.isOpen?"close":"open"]()};if(this.$label)this.$label.off("click").on("click",function(n){n.target.nodeName.toLowerCase()==="label"&&n.target===this&&(r(n),i.options.filter&&i.options.isOpen||i.focus(),n.stopPropagation())});this.$choice.off("click").on("click",r).off("focus").on("focus",this.options.onFocus).off("blur").on("blur",this.options.onBlur);this.$parent.off("keydown").on("keydown",function(n){switch(n.which){case 27:i.close();i.$choice.focus()}});this.$searchInput.off("keydown").on("keydown",function(n){n.keyCode===9&&n.shiftKey&&i.close()}).off("keyup").on("keyup",function(n){if(i.options.filterAcceptOnEnter&&(n.which===13||n.which==32)&&i.$searchInput.val()){i.$selectAll.click();i.close();i.focus();return}i.filter()});this.$selectAll.off("click").on("click",function(){var t=n(this).prop("checked"),r=i.$selectItems.filter(":visible");r.length===i.$selectItems.length?i[t?"checkAll":"uncheckAll"]():(i.$selectGroups.prop("checked",t),r.prop("checked",t),i.options[t?"onCheckAll":"onUncheckAll"](),i.update())});this.$selectGroups.off("click").on("click",function(){var f=n(this).parent().attr("data-group"),e=i.$selectItems.filter(":visible"),r=e.filter(t('[data-group="%s"]',f)),u=r.length!==r.filter(":checked").length;r.prop("checked",u);i.updateSelectAll();i.update();i.options.onOptgroupClick({label:n(this).parent().text(),checked:u,children:r.get(),instance:i})});this.$selectItems.off("click").on("click",function(){i.updateSelectAll();i.update();i.updateOptGroupSelect();i.options.onClick({label:n(this).parent().text(),value:n(this).val(),checked:n(this).prop("checked"),instance:i});if(i.options.single&&i.options.isOpen&&!i.options.keepOpen&&i.close(),i.options.single){var t=n(this).val();i.$selectItems.filter(function(){return n(this).val()==t?!1:!0}).each(function(){n(this).prop("checked",!1)});i.update()}})},open:function(){if(!this.$choice.hasClass("disabled")){if(this.options.isOpen=!0,this.$choice.find(">div").addClass("open"),this.$drop.show(),this.$selectAll.parent().show(),this.$noResults.hide(),this.$el.children().length||(this.$selectAll.parent().hide(),this.$noResults.show()),this.options.container){var t=this.$drop.offset();this.$drop.appendTo(n(this.options.container));this.$drop.offset({top:t.top,left:t.left})}this.options.filter&&(this.$searchInput.val(""),this.$searchInput.focus(),this.filter());this.options.onOpen()}},close:function(){this.options.isOpen=!1;this.$choice.find(">div").removeClass("open");this.$drop.hide();this.options.container&&(this.$parent.append(this.$drop),this.$drop.css({top:"auto",left:"auto"}));this.options.onClose()},update:function(i){var u=this.options.displayValues?this.getSelects():this.getSelects("text"),r=this.$choice.find(">span"),f=u.length;f===0?r.addClass("placeholder").html(this.options.placeholder):this.options.allSelected&&f===this.$selectItems.length+this.$disableItems.length?r.removeClass("placeholder").html(this.options.allSelected):this.options.ellipsis&&f>this.options.minimumCountSelected?r.removeClass("placeholder").text(u.slice(0,this.options.minimumCountSelected).join(this.options.delimiter)+"..."):this.options.countSelected&&f>this.options.minimumCountSelected?r.removeClass("placeholder").html(this.options.countSelected.replace("#",u.length).replace("%",this.$selectItems.length+this.$disableItems.length)):r.removeClass("placeholder").text(u.join(this.options.delimiter));this.options.addTitle&&r.prop("title",this.getSelects("text"));this.$el.val(this.getSelects()).trigger("change");this.$drop.find("li").removeClass("selected");this.$drop.find(t("input[%s]:checked",this.selectItemName)).each(function(){n(this).parents("li").first().addClass("selected")});i||this.$el.trigger("change")},updateSelectAll:function(n){var t=this.$selectItems;n||(t=t.filter(":visible"));this.$selectAll.prop("checked",t.length&&t.length===t.filter(":checked").length);!n&&this.$selectAll.prop("checked")&&this.options.onCheckAll()},updateOptGroupSelect:function(){var i=this.$selectItems.filter(":visible");n.each(this.$selectGroups,function(r,u){var e=n(u).parent().attr("data-group"),f=i.filter(t('[data-group="%s"]',e));n(u).prop("checked",f.length&&f.length===f.filter(":checked").length)})},getSelects:function(i){var u=this,r=[],f=[];return this.$drop.find(t("input[%s]:checked",this.selectItemName)).each(function(){r.push(n(this).parents("li").first().text());f.push(n(this).val())}),i==="text"&&this.$selectGroups.length&&(r=[],this.$selectGroups.each(function(){var i=[],s=n.trim(n(this).parent().text()),h=n(this).parent().data("group"),o=u.$drop.find(t('[%s][data-group="%s"]',u.selectItemName,h)),f=o.filter(":checked"),e;f.length&&(i.push("["),i.push(s),o.length>f.length&&(e=[],f.each(function(){e.push(n(this).parent().text())}),i.push(": "+e.join(", "))),i.push("]"),r.push(i.join("")))})),i==="text"?r:f},setSelects:function(i){var r=this;this.$selectItems.prop("checked",!1);n.each(i,function(n,i){r.$selectItems.filter(t('[value="%s"]',i)).prop("checked",!0)});this.$selectAll.prop("checked",this.$selectItems.length===this.$selectItems.filter(":checked").length);n.each(r.$selectGroups,function(t,i){var f=n(i).parent().attr("data-group"),u=r.$selectItems.filter('[data-group="'+f+'"]');n(i).prop("checked",u.length&&u.length===u.filter(":checked").length)});this.update()},enable:function(){this.$choice.removeClass("disabled")},disable:function(){this.$choice.addClass("disabled")},checkAll:function(){this.$selectItems.prop("checked",!0);this.$selectGroups.prop("checked",!0);this.$selectAll.prop("checked",!0);this.update();this.options.onCheckAll()},uncheckAll:function(){this.$selectItems.prop("checked",!1);this.$selectGroups.prop("checked",!1);this.$selectAll.prop("checked",!1);this.update();this.options.onUncheckAll()},focus:function(){this.$choice.focus();this.options.onFocus()},blur:function(){this.$choice.blur();this.options.onBlur()},refresh:function(){this.init()},filter:function(){var i=this,t=n.trim(this.$searchInput.val()).toLowerCase();t.length===0?(this.$selectAll.parent().show(),this.$selectItems.parent().show(),this.$disableItems.parent().show(),this.$selectGroups.parent().show(),this.$noResults.hide()):(this.$selectItems.each(function(){var i=n(this).parent();i[i.text().toLowerCase().indexOf(t)<0?"hide":"show"]()}),this.$disableItems.parent().hide(),this.$selectGroups.each(function(){var t=n(this).parent(),r=t.attr("data-group"),u=i.$selectItems.filter(":visible");t[u.filter('[data-group="'+r+'"]').length===0?"hide":"show"]()}),this.$selectItems.parent().filter(":visible").length?(this.$selectAll.parent().show(),this.$noResults.hide()):(this.$selectAll.parent().hide(),this.$noResults.show()));this.updateOptGroupSelect();this.updateSelectAll()}};n.fn.multipleSelect=function(){var t=arguments[0],r=arguments,u,f=["getSelects","setSelects","enable","disable","checkAll","uncheckAll","focus","blur","refresh","close"];return this.each(function(){var o=n(this),e=o.data("multipleSelect"),s=n.extend({},n.fn.multipleSelect.defaults,o.data(),typeof t=="object"&&t);if(e||(e=new i(o,s),o.data("multipleSelect",e)),typeof t=="string"){if(n.inArray(t,f)<0)throw"Unknown method: "+t;u=e[t](r[1])}else e.init(),r[1]&&(u=e[r[1]].apply(e,[].slice.call(r,2)))}),typeof u!="undefined"?u:this};n.fn.multipleSelect.defaults={name:"",isOpen:!1,placeholder:"",selectAll:!0,selectAllDelimiter:["[","]"],minimumCountSelected:3,ellipsis:!1,multiple:!1,multipleWidth:80,single:!1,filter:!1,width:undefined,maxHeight:250,container:null,position:"bottom",keepOpen:!1,displayValues:!1,delimiter:", ",addTitle:!1,filterAcceptOnEnter:!1,hideOptgroupCheckboxes:!1,selectAllText:"Select all",allSelected:"All selected",countSelected:"# of % selected",noMatchesFound:"No matches found",styler:function(){return!1},textTemplate:function(n){return n.text()},labelTemplate:function(n){return n.attr("label")},onOpen:function(){return!1},onClose:function(){return!1},onCheckAll:function(){return!1},onUncheckAll:function(){return!1},onFocus:function(){return!1},onBlur:function(){return!1},onOptgroupClick:function(){return!1},onClick:function(){return!1}}})(jQuery);