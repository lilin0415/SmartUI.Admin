(function(n){function i(n){return typeof n=="undefined"?!1:!0}function tt(n){return!i(n)||typeof n=="object"}function g(t,r){var c,u,f,h;if(i(r.customValues))for(key in r.customValues)if(t==r.customValues[key])return key;if(c=/^((\d{1,2}|\*)\s){4}(\d{1,2}|\*)$/,typeof t!="string"||!c.test(t))return n.error("cron: invalid initial value"),undefined;var e=t.split(" "),l=[0,0,1,1,0],a=[59,23,31,12,6];for(u=0;u<e.length;u++)if(e[u]!="*"&&(f=parseInt(e[u]),!i(f)||!(f<=a[u])||!(f>=l[u])))return n.error("cron: invalid value found (col "+(u+1)+") in "+o.initial),undefined;for(h in s)if(s[h].test(t))return h;return n.error("cron: valid but unsupported cron format. sorry."),undefined}function it(t,r){if(!i(g(r.initial,r))||!tt(r.customValues))return!0;if(i(r.customValues))for(key in r.customValues)if(s.hasOwnProperty(key))return n.error("cron: reserved keyword '"+key+"' should not be used as customValues key."),!0;return!1}function rt(n){var t=n.data("block"),i=hour=day=month=dow="*",r=t.period.find("select").val();switch(r){case"minute":break;case"hour":i=t.mins.find("select").val();break;case"day":i=t.time.find("select.cron-time-min").val();hour=t.time.find("select.cron-time-hour").val();break;case"week":i=t.time.find("select.cron-time-min").val();hour=t.time.find("select.cron-time-hour").val();dow=t.dow.find("select").val();break;case"month":i=t.time.find("select.cron-time-min").val();hour=t.time.find("select.cron-time-hour").val();day=t.dom.find("select").val();break;case"year":i=t.time.find("select.cron-time-min").val();hour=t.time.find("select.cron-time-hour").val();day=t.dom.find("select").val();month=t.month.find("select").val();break;default:return r}return[i,hour,day,month,dow].join(" ")}for(var l,f,a,b,v,y,p,w,e,s,u,h,r={initial:"* * * * *",minuteOpts:{minWidth:100,itemWidth:30,columns:4,rows:undefined,title:"Minutes Past the Hour"},timeHourOpts:{minWidth:100,itemWidth:20,columns:2,rows:undefined,title:"Time: Hour"},domOpts:{minWidth:100,itemWidth:30,columns:undefined,rows:10,title:"Day of Month"},monthOpts:{minWidth:100,itemWidth:100,columns:2,rows:undefined,title:undefined},dowOpts:{minWidth:100,itemWidth:undefined,columns:undefined,rows:undefined,title:undefined},timeMinuteOpts:{minWidth:100,itemWidth:20,columns:4,rows:undefined,title:"Time: Minute"},effectOpts:{openSpeed:400,closeSpeed:400,openEffect:"slide",closeEffect:"slide",hideOnMouseOut:!0},url_set:undefined,customValues:undefined,onChange:undefined,useGentleSelect:!1},c="",t=0;t<60;t++)f=t<10?"0":"",c+="<option value='"+t+"'>"+f+t+"<\/option>\n";for(l="",t=0;t<24;t++)f=t<10?"0":"",l+="<option value='"+t+"'>"+f+t+"<\/option>\n";for(a="",t=1;t<32;t++)b=t==1||t==21||t==31?"st":t==2||t==22?"nd":t==3||t==23?"rd":"th",a+="<option value='"+t+"'>"+t+b+"<\/option>\n";for(v="",y=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],t=0;t<y.length;t++)v+="<option value='"+(t+1)+"'>"+y[t]+"<\/option>\n";for(p="",w=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],t=0;t<w.length;t++)p+="<option value='"+t+"'>"+w[t]+"<\/option>\n";var k="",d=["minute","hour","day","week","month","year"],nt=["分","时","天","周","月","年"];for(t=0;t<d.length;t++)k+="<option value='"+d[t]+"'>"+nt[t]+"<\/option>\n";e={minute:[],hour:["mins"],day:["time"],week:["dow","time"],month:["dom","time"],year:["dom","month","time"]};s={minute:/^(\*\s){4}\*$/,hour:/^\d{1,2}\s(\*\s){3}\*$/,day:/^(\d{1,2}\s){2}(\*\s){2}\*$/,week:/^(\d{1,2}\s){2}(\*\s){2}\d{1,2}$/,month:/^(\d{1,2}\s){3}\*\s\*$/,year:/^(\d{1,2}\s){4}\*$/};u={init:function(t){var s=t?t:{},f=n.extend([],r,s),y=n.extend({},r.effectOpts,s.effectOpts),b,o;if(n.extend(f,{minuteOpts:n.extend({},r.minuteOpts,y,s.minuteOpts),domOpts:n.extend({},r.domOpts,y,s.domOpts),monthOpts:n.extend({},r.monthOpts,y,s.monthOpts),dowOpts:n.extend({},r.dowOpts,y,s.dowOpts),timeHourOpts:n.extend({},r.timeHourOpts,y,s.timeHourOpts),timeMinuteOpts:n.extend({},r.timeMinuteOpts,y,s.timeMinuteOpts)}),it(this,f))return this;var e=[],d="",w=f.customValues;if(i(w))for(b in w)d+="<option value='"+w[b]+"'>"+b+"<\/option>\n";return e.period=n("<span class='cron-period'>每 <select name='cron-period'>"+d+k+"<\/select> <\/span>").appendTo(this).data("root",this),o=e.period.find("select"),o.bind("change.cron",h.periodChanged).data("root",this),f.useGentleSelect&&o.gentleSelect(y),e.month=n("<span class='cron-block cron-block-month'>  <select name='cron-month'>"+v+"<\/select>， <\/span>").appendTo(this).data("root",this),o=e.month.find("select").data("root",this),f.useGentleSelect&&o.gentleSelect(f.monthOpts),e.dom=n("<span class='cron-block cron-block-dom'>第 <select name='cron-dom'>"+a+"<\/select> 天， <\/span>").appendTo(this).data("root",this),o=e.dom.find("select").data("root",this),f.useGentleSelect&&o.gentleSelect(f.domOpts),e.mins=n("<span class='cron-block cron-block-mins'> 第 <select name='cron-mins'>"+c+"<\/select> 分minutes past the hour <\/span>").appendTo(this).data("root",this),o=e.mins.find("select").data("root",this),f.useGentleSelect&&o.gentleSelect(f.minuteOpts),e.dow=n("<span class='cron-block cron-block-dow'> <select name='cron-dow'>"+p+"<\/select>， <\/span>").appendTo(this).data("root",this),o=e.dow.find("select").data("root",this),f.useGentleSelect&&o.gentleSelect(f.dowOpts),e.time=n("<span class='cron-block cron-block-time'> 时间 <select name='cron-time-hour' class='cron-time-hour'>"+l+"<\/select>:<select name='cron-time-min' class='cron-time-min'>"+c+" <\/span>").appendTo(this).data("root",this),o=e.time.find("select.cron-time-hour").data("root",this),f.useGentleSelect&&o.gentleSelect(f.timeHourOpts),o=e.time.find("select.cron-time-min").data("root",this),f.useGentleSelect&&o.gentleSelect(f.timeMinuteOpts),e.controls=n("<span class='cron-controls'>&laquo; save <span class='cron-button cron-button-save'><\/span> <\/span>").appendTo(this).data("root",this).find("span.cron-button-save").bind("click.cron",h.saveClicked).data("root",this).end(),this.find("select").bind("change.cron-callback",h.somethingChanged),this.data("options",f).data("block",e),this.data("current_value",f.initial),u.value.call(this,f.initial)},value:function(n){var c,r,u,a;if(!n)return rt(this);var f=this.data("options"),s=this.data("block"),h=f.useGentleSelect,t=g(n,f);if(!i(t))return!1;if(i(f.customValues)&&f.customValues.hasOwnProperty(t))t=f.customValues[t];else{var o=n.split(" "),l={mins:o[0],hour:o[1],dom:o[2],month:o[3],dow:o[4]},v=e[t];for(c=0;c<v.length;c++)r=v[c],r=="time"?(u=s[r].find("select.cron-time-hour").val(l.hour),h&&u.gentleSelect("update"),u=s[r].find("select.cron-time-min").val(l.mins),h&&u.gentleSelect("update")):(u=s[r].find("select").val(l[r]),h&&u.gentleSelect("update"))}return a=s.period.find("select").val(t),h&&a.gentleSelect("update"),a.trigger("change"),this}};h={periodChanged:function(){var i=n(this).data("root"),u=i.data("block"),o=i.data("options"),f=n(this).val(),r,t;if(i.find("span.cron-block").hide(),e.hasOwnProperty(f))for(r=e[n(this).val()],t=0;t<r.length;t++)u[r[t]].show()},somethingChanged:function(){root=n(this).data("root");i(root.data("options").url_set)?u.value.call(root)!=root.data("current_value")?(root.addClass("cron-changed"),root.data("block").controls.fadeIn()):(root.removeClass("cron-changed"),root.data("block").controls.fadeOut()):root.data("block").controls.hide();var t=root.data("options").onChange;i(t)&&n.isFunction(t)&&t.call(root)},saveClicked:function(){var i=n(this),t=i.data("root"),r=u.value.call(t);i.hasClass("cron-loading")||(i.addClass("cron-loading"),n.ajax({type:"POST",url:t.data("options").url_set,data:{cron:r},success:function(){t.data("current_value",r);i.removeClass("cron-loading");r==u.value.call(t)&&(t.removeClass("cron-changed"),t.data("block").controls.fadeOut())},error:function(){alert("An error occured when submitting your request. Try again?");i.removeClass("cron-loading")}}))}};n.fn.cron=function(t){if(u[t])return u[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t!="object"&&t)n.error("Method "+t+" does not exist on jQuery.cron");else return u.init.apply(this,arguments)}})(jQuery);